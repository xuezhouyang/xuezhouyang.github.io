<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jackson Tool Ultimate</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: { bg: '#0f172a', surface: '#1e293b', border: '#334155', text: '#e2e8f0', textMuted: '#94a3b8' }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; }
        .font-code { font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace; }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background: #475569; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        textarea:focus { outline: none; }
        
        /* Animations */
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .toast-enter { animation: slideUp 0.3s ease-out forwards; }
        .fade-in { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Splitter Resizer */
        .resizer { width: 5px; cursor: col-resize; transition: background 0.2s; z-index: 10; }
        .resizer:hover, .resizer.active { background-color: #3b82f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- 1. Icons & Utilities ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Icons = {
            Moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />,
            Sun: <><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></>,
            Terminal: <><polyline points="4 17 10 11 4 5" /><line x1="12" y1="19" x2="20" y2="19" /></>,
            Check: <polyline points="20 6 9 17 4 12" />,
            Alert: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>,
            Copy: <><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></>,
            Trash: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>,
            Format: <><polyline points="4 14 10 14 10 20" /><polyline points="20 10 14 10 14 4" /><line x1="14" y1="10" x2="21" y2="3" /><line x1="3" y1="21" x2="10" y2="14" /></>,
            Compress: <><polyline points="4 7 10 7 10 1" /><polyline points="20 17 14 17 14 23" /><line x1="14" y1="17" x2="21" y2="24" /><line x1="3" y1="0" x2="10" y2="7" /></>,
            ChevronRight: <polyline points="9 18 15 12 9 6" />,
            ChevronDown: <polyline points="6 9 12 15 18 9" />,
            Search: <><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></>,
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
            History: <><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /><path d="M12 7v5l4 2" /></>,
            Code: <><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></>,
            Escape: <><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></>,
            Pin: <><line x1="12" y1="17" x2="12" y2="22" /><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z" /></>,
            Maximize: <><polyline points="15 3 21 3 21 9" /><polyline points="9 21 3 21 3 15" /><line x1="21" y1="3" x2="14" y2="10" /><line x1="3" y1="21" x2="10" y2="14" /></>,
            X: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
            ArrowUpRight: <><line x1="7" y1="17" x2="17" y2="7" /><polyline points="7 7 17 7 17 17" /></>
        };

        // --- Java Code Generator ---
        const generateJavaCode = (json, rootName = "Root") => {
            let buffer = "";
            const capitalize = (s) => s.charAt(0).toUpperCase() + s.slice(1);
            
            const getType = (val) => {
                if (val === null) return "Object";
                if (typeof val === 'string') return "String";
                if (typeof val === 'number') return Number.isInteger(val) ? "int" : "double";
                if (typeof val === 'boolean') return "boolean";
                if (Array.isArray(val)) {
                    if (val.length === 0) return "List<Object>";
                    return `List<${getType(val[0])}>`; 
                }
                if (typeof val === 'object') return capitalize("NestedObject"); 
                return "Object";
            };

            const generateClass = (obj, className) => {
                let sb = `@Data\npublic class ${className} {\n`;
                for (const key in obj) {
                    const type = getType(obj[key]);
                    const fieldName = key.includes('_') ? key.replace(/_([a-z])/g, (g) => g[1].toUpperCase()) : key;
                    if (fieldName !== key) sb += `    @JsonProperty("${key}")\n`;
                    if (typeof obj[key] === 'object' && obj[key] !== null && !Array.isArray(obj[key])) {
                        const nestedClassName = capitalize(fieldName);
                        sb += `    private ${nestedClassName} ${fieldName};\n`;
                    } else if (Array.isArray(obj[key]) && obj[key].length > 0 && typeof obj[key][0] === 'object') {
                         sb += `    private List<${capitalize(fieldName)}Item> ${fieldName};\n`;
                    } else {
                        sb += `    private ${type} ${fieldName};\n`;
                    }
                }
                sb += "}\n";
                return sb;
            };
            try {
                const obj = JSON.parse(json);
                if (Array.isArray(obj) && obj.length > 0) return generateClass(obj[0], rootName);
                if (typeof obj === 'object') return generateClass(obj, rootName);
                return "// Not an object or array";
            } catch (e) { return "// Invalid JSON"; }
        };

        // --- Toast ---
        const ToastContext = React.createContext();
        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);
            const addToast = (msg, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 2000);
            };
            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed top-4 right-4 z-50 flex flex-col gap-2">
                        {toasts.map(t => (
                            <div key={t.id} className={`toast-enter px-4 py-2 rounded shadow-lg text-white text-sm font-medium ${t.type === 'error' ? 'bg-red-500' : 'bg-green-600'}`}>
                                {t.msg}
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };
        const useToast = () => React.useContext(ToastContext);

        // --- NEW Block-Style Json Node ---
        const JsonNode = React.memo(({ name, value, isLast, depth = 0, path = [], highlightPath, searchTerm, smartParse, onKeyClick }) => {
            const [expanded, setExpanded] = useState(true);
            const { value: actualValue, isJsonString } = useMemo(() => {
                if (smartParse && typeof value === 'string') {
                    try { const p = JSON.parse(value); if(typeof p==='object' && p) return {value:p, isJsonString:true}; } catch(e){}
                }
                return { value, isJsonString: false };
            }, [value, smartParse]);

            const isObject = actualValue !== null && typeof actualValue === 'object';
            const isArray = Array.isArray(actualValue);
            const isEmpty = isObject && Object.keys(actualValue).length === 0;

            const matchesSearch = useMemo(() => {
                if (!searchTerm) return true;
                const lowerKey = name ? String(name).toLowerCase() : "";
                const lowerVal = (typeof actualValue !== 'object') ? String(actualValue).toLowerCase() : "";
                return lowerKey.includes(searchTerm) || lowerVal.includes(searchTerm);
            }, [name, actualValue, searchTerm]);

            useEffect(() => { if (searchTerm) setExpanded(true); }, [searchTerm]);

            const isHighlighted = useMemo(() => {
                if (!highlightPath || highlightPath.length === 0) return false;
                return path.length === highlightPath.length && path.every((p, i) => p == highlightPath[i]);
            }, [path, highlightPath]);

            const toggle = (e) => { e.stopPropagation(); setExpanded(!expanded); };
            const handleKeyClick = (e) => {
                e.stopPropagation();
                if (name !== null) onKeyClick(path);
            };

            const renderPrimitive = (val) => {
                if (val === null) return <span className="text-red-500 dark:text-red-400 font-bold">null</span>;
                if (typeof val === 'string') return <span className="text-green-600 dark:text-green-400 break-all">"{val}"</span>;
                if (typeof val === 'number') return <span className="text-blue-600 dark:text-blue-400">{val}</span>;
                if (typeof val === 'boolean') return <span className="text-purple-600 dark:text-purple-400 font-bold">{val.toString()}</span>;
                return <span>{String(val)}</span>;
            };

            // UPDATE 1: Background and Border only on Hover
            const blockBg = depth > 0 ? 'hover:bg-slate-500/5 dark:hover:bg-white/5' : '';
            // UPDATE 2: Border transparent by default, visible on hover
            const blockBorder = depth > 0 ? 'border-l border-transparent hover:border-slate-300 dark:hover:border-slate-700' : '';
            const highlightClass = isHighlighted ? 'bg-yellow-200/50 dark:bg-yellow-900/30 ring-1 ring-yellow-400' : '';

            // --- Object/Array Rendering ---
            if (isObject) {
                const keys = Object.keys(actualValue);
                const Opening = isArray ? '[' : '{';
                const Closing = isArray ? ']' : '}';
                const label = name !== null ? (
                    <span 
                        className="text-purple-700 dark:text-purple-400 font-bold cursor-pointer hover:underline hover:text-purple-600" 
                        title="点击获取路径建议"
                        onClick={handleKeyClick}
                    >
                        {name} {/* UPDATE 3: Removed quotes for cleaner look */}
                    </span>
                ) : null;
                
                return (
                    <div className={`font-code text-sm leading-6 my-0.5 rounded-sm ${blockBg} ${blockBorder} ${highlightClass} transition-colors duration-200`}>
                        {/* Header Row */}
                        <div className="flex items-start px-2 py-0.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-t-sm">
                            {/* Toggle Arrow */}
                            <span 
                                onClick={toggle}
                                className={`mr-1 mt-1 text-slate-400 cursor-pointer hover:text-slate-600 transition-transform ${isEmpty ? 'invisible' : ''}`}
                            >
                                <Icon children={expanded ? Icons.ChevronDown : Icons.ChevronRight} className="w-3.5 h-3.5"/>
                            </span>

                            {/* Key & Opening Bracket */}
                            <div className="flex-1">
                                {label}
                                {name !== null && <span className="mr-1">:</span>}
                                {isJsonString && <span className="mr-2 px-1 text-[10px] bg-amber-100 text-amber-800 rounded border border-amber-200">JSON</span>}
                                <span className="text-slate-500 dark:text-slate-400 font-bold">{Opening}</span>
                                
                                {/* Collapsed Summary */}
                                {!expanded && !isEmpty && (
                                    <span 
                                        className="text-slate-400 mx-2 text-xs bg-black/5 dark:bg-white/10 px-1.5 rounded cursor-pointer hover:bg-black/10"
                                        onClick={toggle}
                                    >
                                        ... {keys.length} items ...
                                    </span>
                                )}

                                {/* Collapsed Closing Bracket */}
                                {!expanded && <span className="text-slate-500 dark:text-slate-400 font-bold">{Closing}{!isLast && ','}</span>}
                            </div>
                        </div>

                        {/* Children Block (The Value) */}
                        {expanded && !isEmpty && (
                            <div className="pl-4 pr-1 pb-1">
                                {keys.map((key, idx) => (
                                    <JsonNode 
                                        key={key} 
                                        name={isArray ? null : key} 
                                        value={actualValue[key]} 
                                        isLast={idx === keys.length - 1} 
                                        depth={depth + 1} 
                                        path={[...path, key]} 
                                        highlightPath={highlightPath} 
                                        searchTerm={searchTerm} 
                                        smartParse={smartParse}
                                        onKeyClick={onKeyClick}
                                    />
                                ))}
                                <div className="text-slate-500 dark:text-slate-400 font-bold pl-1">{Closing}{!isLast && ','}</div>
                            </div>
                        )}
                         
                        {/* Empty Object Closing */}
                        {expanded && isEmpty && (
                            <div className="pl-8 text-slate-500 dark:text-slate-400 font-bold">{Closing}{!isLast && ','}</div>
                        )}
                    </div>
                );
            }

            // --- Primitive Rendering ---
            return (
                <div className={`flex font-code text-sm leading-6 px-2 py-0.5 rounded-sm hover:bg-black/5 dark:hover:bg-white/5 transition-colors ${highlightClass} ${searchTerm && matchesSearch ? 'bg-blue-100/50 dark:bg-blue-900/30' : ''}`}>
                    <span className="w-4 shrink-0"></span> {/* Alignment spacer for leaf nodes */}
                    {name !== null && (
                        <>
                            <span 
                                className="text-purple-700 dark:text-purple-400 mr-0.5 cursor-pointer hover:underline"
                                onClick={handleKeyClick}
                            >
                                {name} {/* Removed quotes */}
                            </span>
                            <span className="mr-2">:</span>
                        </>
                    )}
                    {renderPrimitive(actualValue)}
                    {!isLast && <span className="text-slate-500">,</span>}
                </div>
            );
        });

        // --- 3. Main Application ---
        const App = () => {
            const { addToast } = useToast();
            
            // --- State ---
            const [darkMode, setDarkMode] = useState(false);
            const [jsonStr, setJsonStr] = useState("");
            const [parsedData, setParsedData] = useState(null);
            const [errorInfo, setErrorInfo] = useState(null); 
            
            const [path, setPath] = useState("");
            const [suggestedPath, setSuggestedPath] = useState(null); // New: Suggestion State
            const [pathResult, setPathResult] = useState(null);
            
            const [showCodeGen, setShowCodeGen] = useState(false);
            const [smartParse, setSmartParse] = useState(false);
            const [searchTerm, setSearchTerm] = useState("");
            const [splitPos, setSplitPos] = useState(50); 
            const isResizing = useRef(false);
            const [panelState, setPanelState] = useState('collapsed'); 
            
            const editorRef = useRef(null);
            const lineRef = useRef(null);
            const containerRef = useRef(null); 

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            useEffect(() => {
                if (!jsonStr.trim()) { setParsedData(null); setErrorInfo(null); return; }
                try {
                    const data = JSON.parse(jsonStr);
                    setParsedData(data);
                    setErrorInfo(null);
                } catch (e) {
                    setParsedData(null);
                    const match = e.message.match(/at position (\d+)/);
                    let line = 1;
                    if (match) {
                        const pos = parseInt(match[1]);
                        line = jsonStr.substring(0, pos).split('\n').length;
                    }
                    setErrorInfo({ message: e.message, line });
                }
            }, [jsonStr]);

            const resolvePathLogic = useCallback(() => {
                if (!parsedData || !path) { setPathResult(null); return; }
                let parts = path.startsWith('/') ? 
                    path.split('/').slice(1).map(p => p.replace(/~1/g, '/')) : 
                    path.replace(/\[(\d+)\]/g, '.$1').split('.');
                
                let current = parsedData;
                let traversed = [];
                let status = 'found';
                
                for (let key of parts) {
                    if (current === null || typeof current !== 'object' || !(key in current)) {
                        status = 'missing'; break;
                    }
                    current = current[key];
                    traversed.push(key);
                }
                setPathResult({ status, value: current, pathTraversed: traversed });
            }, [parsedData, path]);

            useEffect(resolvePathLogic, [parsedData, path]);

            const handleKeyClick = useCallback((keyPath) => {
                // Construct path string (Jackson Pointer style)
                const pathStr = "/" + keyPath.join("/");
                if (pathStr !== path) {
                    setSuggestedPath(pathStr);
                }
            }, [path]);

            const applySuggestion = () => {
                if (suggestedPath) {
                    setPath(suggestedPath);
                    setSuggestedPath(null);
                    if (panelState === 'collapsed') setPanelState('expanded');
                }
            };

            const handleFormat = () => { if(parsedData) { setJsonStr(JSON.stringify(parsedData, null, 4)); addToast("已格式化"); }};
            const handleCompress = () => { if(parsedData) { setJsonStr(JSON.stringify(parsedData)); addToast("已压缩"); }};
            const handleClear = () => setJsonStr("");
            const handleEscape = () => { setJsonStr(JSON.stringify(jsonStr)); addToast("已转义"); };
            const handleUnescape = () => { try { setJsonStr(JSON.parse(jsonStr)); addToast("已去转义"); } catch(e){ addToast("无法去转义", 'error'); }};
            
            const handleDrop = (e) => {
                e.preventDefault();
                const file = e.dataTransfer.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => setJsonStr(ev.target.result);
                    reader.readAsText(file);
                    addToast("文件已加载");
                }
            };

            const startResize = (e) => { isResizing.current = true; document.addEventListener('mousemove', handleResize); document.addEventListener('mouseup', stopResize); };
            const stopResize = () => { isResizing.current = false; document.removeEventListener('mousemove', handleResize); document.removeEventListener('mouseup', stopResize); };
            const handleResize = (e) => {
                if (!isResizing.current || !containerRef.current) return;
                const containerRect = containerRef.current.getBoundingClientRect();
                const newPos = ((e.clientX - containerRect.left) / containerRect.width) * 100;
                if (newPos > 10 && newPos < 90) setSplitPos(newPos);
            };

            const handleScroll = (e) => { if (lineRef.current) lineRef.current.scrollTop = e.target.scrollTop; };

            return (
                <div className={`flex flex-col h-screen ${darkMode ? 'dark' : ''} bg-slate-50 dark:bg-dark-bg text-slate-800 dark:text-dark-text`}>
                    
                    {/* --- Toolbar --- */}
                    <div className="h-14 bg-white dark:bg-dark-surface border-b border-slate-200 dark:border-dark-border flex items-center justify-between px-4 shrink-0 z-20">
                        <div className="flex items-center gap-3 font-bold text-slate-700 dark:text-slate-200">
                            <span className="bg-blue-600 text-white p-1.5 rounded-lg"><Icon children={Icons.Terminal} className="w-5 h-5"/></span>
                            <span>Jackson Ultimate</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg">
                                <button onClick={handleFormat} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-blue-600" title="格式化"><Icon children={Icons.Format}/></button>
                                <button onClick={handleCompress} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-purple-600" title="压缩"><Icon children={Icons.Compress}/></button>
                                <button onClick={handleClear} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-red-500" title="清空"><Icon children={Icons.Trash}/></button>
                            </div>
                            <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg">
                                <button onClick={handleEscape} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-amber-600" title="转义"><Icon children={Icons.Escape}/></button>
                                <button onClick={handleUnescape} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-amber-600" title="去转义"><Icon children={Icons.Code}/></button>
                                <button onClick={() => setShowCodeGen(true)} className="p-2 hover:bg-white dark:hover:bg-slate-700 rounded text-green-600 font-bold text-xs px-3" title="POJO Gen">POJO</button>
                            </div>
                            <button onClick={() => setDarkMode(!darkMode)} className="p-2 text-slate-500 dark:text-slate-400 hover:text-blue-500">
                                <Icon children={darkMode ? Icons.Sun : Icons.Moon} />
                            </button>
                        </div>
                    </div>

                    {/* --- Main Area --- */}
                    <div className="flex-1 flex overflow-hidden relative" ref={containerRef}>
                        {/* Editor */}
                        <div style={{ width: `${splitPos}%` }} className="flex flex-col border-r border-slate-200 dark:border-dark-border bg-white dark:bg-dark-bg min-w-[200px]">
                            <div className="h-8 bg-slate-50 dark:bg-slate-900 border-b border-slate-100 dark:border-dark-border flex items-center px-4 text-xs text-slate-500 font-bold justify-between">
                                <span>INPUT SOURCE</span>
                                {errorInfo && <span className="text-red-500 flex items-center gap-1"><Icon children={Icons.Alert} className="w-3 h-3"/> Error: Line {errorInfo.line}</span>}
                            </div>
                            <div className="flex-1 relative flex overflow-hidden" onDragOver={e=>e.preventDefault()} onDrop={handleDrop}>
                                <div className="w-12 bg-slate-50 dark:bg-slate-900 border-r border-slate-100 dark:border-dark-border text-right pr-2 pt-4 text-slate-400 text-xs font-code leading-6 select-none" ref={lineRef}>
                                    {jsonStr.split('\n').map((_, i) => (
                                        <div key={i} className={`${errorInfo?.line === i + 1 ? 'bg-red-100 dark:bg-red-900/50 text-red-600' : ''}`}>{i+1}</div>
                                    ))}
                                </div>
                                <textarea 
                                    ref={editorRef} onScroll={handleScroll} 
                                    value={jsonStr} onChange={e => setJsonStr(e.target.value)}
                                    className="flex-1 p-4 bg-transparent font-code text-sm leading-6 resize-none border-none text-slate-800 dark:text-slate-200 custom-scroll whitespace-pre w-full"
                                    spellCheck="false" placeholder="// 粘贴 JSON 或拖入文件..." 
                                />
                            </div>
                        </div>

                        <div className="resizer w-1 bg-slate-200 dark:bg-dark-border hover:bg-blue-400 cursor-col-resize z-10" onMouseDown={startResize}></div>

                        {/* Tree View */}
                        <div style={{ width: `${100 - splitPos}%` }} className="flex flex-col bg-white dark:bg-dark-bg min-w-[200px]">
                            <div className="h-10 bg-slate-50 dark:bg-slate-900 border-b border-slate-100 dark:border-dark-border flex items-center px-2 gap-2">
                                <div className="relative flex-1">
                                    <input 
                                        type="text" value={searchTerm} onChange={e => setSearchTerm(e.target.value)}
                                        className="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs focus:ring-1 focus:ring-blue-500 outline-none"
                                        placeholder="搜索 Key/Value..."
                                    />
                                    {searchTerm && <span className="absolute right-2 top-1 text-xs text-blue-500 font-bold">Filter Active</span>}
                                </div>
                                <label className="flex items-center gap-1 cursor-pointer select-none">
                                    <input type="checkbox" checked={smartParse} onChange={e => setSmartParse(e.target.checked)} className="rounded text-blue-600"/>
                                    <span className="text-[10px] font-bold text-slate-500 dark:text-slate-400">智能解析</span>
                                </label>
                            </div>
                            <div className="flex-1 overflow-auto p-4 custom-scroll relative bg-white dark:bg-dark-bg">
                                {!parsedData ? 
                                    <div className="flex flex-col items-center justify-center h-full text-slate-300 dark:text-slate-600">
                                        <Icon children={Icons.Terminal} className="w-16 h-16 opacity-20"/>
                                        <p className="mt-2 text-sm">Waiting for valid JSON...</p>
                                    </div> : 
                                    <JsonNode 
                                        name={null} value={parsedData} isLast={true} 
                                        highlightPath={pathResult?.status==='found'?pathResult.pathTraversed:[]} 
                                        searchTerm={searchTerm.toLowerCase()} smartParse={smartParse} 
                                        onKeyClick={handleKeyClick}
                                    />
                                }
                            </div>
                        </div>
                    </div>

                    {/* --- Bottom Debug Panel --- */}
                    <div className={`fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-surface border-t border-slate-200 dark:border-dark-border shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-40 transition-all duration-300 flex flex-col`}
                        style={{ height: panelState === 'collapsed' ? '60px' : panelState === 'maximized' ? '100vh' : '400px' }}>
                        
                        {/* Suggestion Bubble (Floating above input) */}
                        {suggestedPath && (
                            <div className="absolute -top-12 left-4 z-50 animate-in slide-in-from-bottom-2 fade-in">
                                <button 
                                    onClick={applySuggestion}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full shadow-lg text-sm font-medium flex items-center gap-2 group"
                                >
                                    <span>路径建议:</span>
                                    <span className="font-mono bg-black/20 px-2 py-0.5 rounded">{suggestedPath}</span>
                                    <Icon children={Icons.ArrowUpRight} className="w-4 h-4 group-hover:translate-x-0.5 transition-transform" />
                                </button>
                                <button 
                                    onClick={() => setSuggestedPath(null)}
                                    className="ml-2 bg-slate-200 dark:bg-slate-700 text-slate-500 hover:text-slate-700 rounded-full p-1 shadow-sm"
                                    title="忽略"
                                >
                                    <Icon children={Icons.X} className="w-4 h-4"/>
                                </button>
                            </div>
                        )}

                        <div className="h-14 flex items-center px-4 gap-4 bg-slate-50 dark:bg-slate-900 shrink-0">
                            <button onClick={() => setPanelState(s => s === 'collapsed' ? 'expanded' : 'collapsed')} className="text-slate-400 hover:text-blue-500">
                                <Icon children={panelState === 'collapsed' ? Icons.ChevronDown : Icons.X} className={`w-5 h-5 transition-transform ${panelState==='collapsed'?'rotate-180':''}`}/>
                            </button>
                            
                            <div className="flex-1 relative group">
                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Icon children={Icons.Search} className="w-4 h-4"/></div>
                                <input type="text" value={path} onChange={e => setPath(e.target.value)} onFocus={() => panelState==='collapsed' && setPanelState('expanded')}
                                    className="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg pl-9 pr-4 py-2 text-sm font-mono focus:ring-2 focus:ring-blue-500 outline-none"
                                    placeholder="输入 Path 调试 (或点击上方 Key 获取建议)..." />
                            </div>

                            {panelState !== 'collapsed' && (
                                <div className="flex gap-2 text-slate-400">
                                    <button onClick={() => setPanelState(s => s === 'pinned' ? 'expanded' : 'pinned')} className={`p-1 hover:text-blue-500 ${panelState==='pinned'?'text-blue-500':''}`} title="钉住"><Icon children={Icons.Pin}/></button>
                                    <button onClick={() => setPanelState(s => s === 'maximized' ? 'expanded' : 'maximized')} className={`p-1 hover:text-blue-500 ${panelState==='maximized'?'text-blue-500':''}`} title="最大化"><Icon children={Icons.Maximize}/></button>
                                </div>
                            )}
                        </div>

                        <div className="flex-1 overflow-auto custom-scroll p-6 bg-white dark:bg-dark-bg">
                            {pathResult?.status === 'found' ? (
                                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2">
                                    <div className="flex items-center gap-2 text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 p-2 rounded border border-green-100 dark:border-green-900">
                                        <Icon children={Icons.Check}/> <span className="font-bold">Found</span>
                                        <span className="text-xs ml-auto bg-white dark:bg-black/20 px-2 py-0.5 rounded font-mono text-slate-600 dark:text-slate-300">{typeof pathResult.value === 'object' ? (Array.isArray(pathResult.value)?'Array':'Object') : typeof pathResult.value}</span>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="border border-slate-200 dark:border-slate-700 rounded bg-slate-50 dark:bg-slate-900">
                                            <div className="px-3 py-1 border-b border-slate-200 dark:border-slate-700 text-xs text-slate-500 font-bold">asText()</div>
                                            <div className="p-3 font-mono text-sm whitespace-pre-wrap break-all">{typeof pathResult.value==='object'&&pathResult.value!==null ? <span className="text-slate-400 italic">(Object)</span> : String(pathResult.value)}</div>
                                        </div>
                                        <div className="border border-slate-200 dark:border-slate-700 rounded bg-slate-50 dark:bg-slate-900">
                                            <div className="px-3 py-1 border-b border-slate-200 dark:border-slate-700 text-xs text-slate-500 font-bold">toString()</div>
                                            <div className="p-3 font-mono text-sm whitespace-pre-wrap break-all text-slate-600 dark:text-slate-400">{JSON.stringify(pathResult.value)}</div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center text-slate-400 mt-10">
                                    {pathResult?.status === 'missing' ? `Path missing at: ${pathResult.pathTraversed.join('/')}` : '输入路径以查看结果...'}
                                </div>
                            )}
                        </div>
                    </div>

                    {showCodeGen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setShowCodeGen(false)}>
                            <div className="bg-white dark:bg-dark-surface w-full max-w-3xl rounded-xl shadow-2xl flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-slate-200 dark:border-dark-border flex justify-between">
                                    <h3 className="font-bold text-lg dark:text-slate-200">Java POJO Generator</h3>
                                    <button onClick={() => setShowCodeGen(false)}><Icon children={Icons.X}/></button>
                                </div>
                                <div className="flex-1 overflow-auto p-4 bg-slate-50 dark:bg-dark-bg">
                                    <pre className="font-code text-sm text-slate-800 dark:text-slate-300">{generateJavaCode(jsonStr)}</pre>
                                </div>
                                <div className="p-4 border-t border-slate-200 dark:border-dark-border flex justify-end">
                                    <button onClick={() => { navigator.clipboard.writeText(generateJavaCode(jsonStr)); addToast("Java 代码已复制"); setShowCodeGen(false); }} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">复制并关闭</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ToastProvider><App /></ToastProvider>);
    </script>
</body>
</html>
